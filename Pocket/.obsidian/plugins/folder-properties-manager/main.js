/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var q=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(d,t)=>{for(var e in t)q(d,e,{get:t[e],enumerable:!0})},ee=(d,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Z(t))!J.call(d,i)&&i!==e&&q(d,i,{get:()=>t[i],enumerable:!(n=X(t,i))||n.enumerable});return d};var te=d=>ee(q({},"__esModule",{value:!0}),d);var ie={};Q(ie,{default:()=>B});module.exports=te(ie);var O=require("obsidian");var b=require("obsidian");var Y=require("obsidian");var T=require("obsidian"),h=class{constructor(t,e){this.app=e,this.vault=e.vault,this.columnIndex=-1,this.filter=[],this.propertyName=t,this.columnId="",this.cnt=0,this.visible=!0,this.isSortedAsc=!0}extractCells(t){let e=[];return t.filter(n=>n.style.display=="").forEach(n=>{let s=n.querySelectorAll("td")[this.getIndex()];s&&e.push(s)}),e}applyV(t){this.extractCells(t).forEach(n=>{this.getV()?n.style.display="":n.style.display="none"})}print(){console.log("*************************"),console.log("prb : ",this.getPropertyName()),console.log("cnt : ",this.getCnt()),console.log("Id  : ",this.getId()),console.log("Idx : ",this.getIndex()),console.log("-------------------------")}addCnt1(){this.cnt++}setCnt(t){this.cnt=t}getCnt(){return this.cnt}getSortedAsc(){return this.isSortedAsc}setId(t){this.columnId=t}getId(){return this.columnId}setV(t){this.visible=t}getV(){return this.visible}setPropertyName(t){this.propertyName=t}getPropertyName(){return this.propertyName}setIndex(t){this.columnIndex=t}getIndex(){return this.columnIndex}setStrType(t){}getStrType(){return""}createHref(t,e){t.createEl("a",{text:e instanceof T.TFile?e.basename:e,cls:"cm-underline",href:e instanceof T.TFile?e.path:"/"+e,attr:{tabindex:"-1"}}).addEventListener("click",i=>{i.preventDefault(),this.app.workspace.openLinkText(e instanceof T.TFile?e.path:"/"+e,"",!1)})}setFilter(t){this.filter=t}getFilter(){return this.filter}async updateYamlProperty(t,e,n,i){let s=this.vault.getAbstractFileByPath(t);if(!(s instanceof T.TFile))return;let l=await this.vault.read(s),r=l.match(/^---\n([\s\S]*?)\n---/),a="{}";r&&(a=r[1]);let o=(0,T.parseYaml)(a);if(i==="update"){if(o[e]==n)return;o[e]=n}else i==="delete"&&(Array.isArray(o[e])?(o[e]=o[e].filter(u=>u!==n),o[e].length===0&&delete o[e]):delete o[e]);let c=(0,T.stringifyYaml)(o);l=r?l.replace(/^---\n[\s\S]*?\n---/,`---
${c}---`):`---
${c}---
${l}`,await this.vault.modify(s,l)}sortRows(t,e){return this.isSortedAsc=e,t.sort((n,i)=>{var r,a,o,c;let s=((a=(r=n.getElementsByTagName("td")[this.columnIndex])==null?void 0:r.textContent)==null?void 0:a.trim().toLowerCase())||"",l=((c=(o=i.getElementsByTagName("td")[this.columnIndex])==null?void 0:o.textContent)==null?void 0:c.trim().toLowerCase())||"";return console.log("->",s,l,s.localeCompare(l),l.localeCompare(s)),e?s.localeCompare(l):l.localeCompare(s)})}};var w=class extends h{constructor(t,e,n="date"){super(t,e),this.dtype=n}getDType(){return this.dtype}filterRows(t){t.forEach(e=>{e.style.display="";let i=e.querySelectorAll("td")[this.getIndex()];if(this.getFilter().length>0){let s=i==null?void 0:i.querySelector("input, select");if(s){let[l,r]=this.getFilter();if(l||r){let a=null;if(s instanceof HTMLInputElement&&s.value.includes("T")?a=new Date(s.value.trim()):s instanceof HTMLInputElement&&(a=new Date(s.value.trim()+"T00:00:00")),a&&!isNaN(a.getTime())){let o=l?new Date(l.trim()):null,c=r?new Date(r.trim()):null;(o&&a<o||c&&a.getTime()>c.getTime()+864e5)&&(e.style.display="none")}else this.getFilter()[2]||(e.style.display="none")}else e.style.display="none"}else e.style.display="none"}})}getStrType(){return this.dtype}getUniqDisplayValuesFiltered(t){let e=null,n=null;return t.forEach(i=>{let s=i.getElementsByTagName("td")[this.columnIndex],l=s==null?void 0:s.querySelector("input, select");if(l&&!isNaN(new Date(l.value.trim()).getTime())){let r=new Date(l.value.trim());(e===null||r<e)&&(e=r),(n===null||r>n)&&(n=r)}}),[e,n,""]}sortRows(t,e){return this.isSortedAsc=e,t.sort((n,i)=>{let s=n.getElementsByTagName("td")[this.columnIndex],l=i.getElementsByTagName("td")[this.columnIndex],r=s==null?void 0:s.querySelector("input, select"),a=l==null?void 0:l.querySelector("input, select"),o=r&&!isNaN(new Date(r.value.trim()).getTime()),c=a&&!isNaN(new Date(a.value.trim()).getTime());if(o&&c){let u=new Date(r.value.trim()).getTime(),p=new Date(a.value.trim()).getTime();return e?u-p:p-u}else return o?e?-1:1:c?e?1:-1:0}),t}getCorrectDateTime(t){let e=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),i=t.getDate().toString().padStart(2,"0"),s=t.getHours().toString().padStart(2,"0"),l=t.getMinutes().toString().padStart(2,"0");return`${e}-${n}-${i}T${s}:${l}`}fillCell(t,e,n,i){t.empty();let s=t.createEl("input",{cls:"ptp-date-button"});if(s.setAttribute("filepath",e.path),s.setAttribute("prop",n),s.type=this.dtype,i!=null&&i!==""){let l=new Date(i);this.dtype=="datetime-local"?s.value=this.getCorrectDateTime(l):s.value=l.toISOString().split("T")[0]}else s.classList.add("ptp-date-gray-input");s.addEventListener("change",async()=>{let l=s.getAttribute("filepath"),r=s.getAttribute("prop"),a=s.value,o=new Date(a),c="";a!==""?(c=s.type==="datetime-local"?this.getCorrectDateTime(o):o.toISOString().split("T")[0],s.classList.remove("ptp-date-gray-input")):s.classList.add("ptp-date-gray-input"),await this.updateYamlProperty(l,r,c,"update")})}};var V=class extends Y.Modal{constructor(t,e,n,i){super(t),this.col=e,this.allowedValues=n,this.onSubmit=i,this.selectedValues=new Set}createCheckbox(t,e){let n=e.createEl("input",{attr:{type:"checkbox"}});this.col.getFilter()&&this.col.getFilter().includes(t)&&(n.checked=!0,this.selectedValues.add(t)),n.addEventListener("change",i=>{i.target.checked?this.selectedValues.add(t):this.selectedValues.delete(t)}),e.createEl("label",{text:t===""?"Include Empty value":String(t)})}createBoolFilter(t){let e=t.createEl("div",{cls:"ptp-filter-value-container"});this.createCheckbox(!0,e);let n=t.createEl("div",{cls:"ptp-filter-value-container"});this.createCheckbox(!1,n);let i=t.createEl("div",{cls:"ptp-filter-value-container"});this.createCheckbox("",i);let s=t.createEl("button",{text:"Filtrer",cls:"ptp-filter-button"});s.addEventListener("click",()=>{this.onSubmit(Array.from(this.selectedValues)),this.close()});let l=t.createEl("button",{text:"Clear Filter",cls:"ptp-filter-button"});l.addEventListener("click",()=>{this.onSubmit([]),this.close()}),t.appendChild(e),t.appendChild(n),t.appendChild(i),t.appendChild(s),t.appendChild(l)}createDateRangeFilter(t){console.log("createDateRag");let{allowedValues:e}=this,n=e.map(p=>new Date(p)).filter(p=>!isNaN(p.getTime())),i=n.length>0?new Date(Math.min(...n.map(p=>p.getTime()))):null,s=n.length>0?new Date(Math.max(...n.map(p=>p.getTime()))):null,l=(p,m,g)=>{let S=t.createEl("div",{cls:"ptp-filter-date-container"});S.createEl("label",{text:p});let z=S.createEl("input",{attr:{type:"date",value:m?m.split("T")[0]:""}});return{container:S,input:z}},{input:r}=l("From : ",i?i.toISOString():null,()=>{i&&(r.value=i.toISOString().split("T")[0])}),{input:a}=l("To : ",s?s.toISOString():null,()=>{s&&(a.value=s.toISOString().split("T")[0])}),o=t.createEl("button",{text:"Filtrer",cls:"ptp-filter-button"});o.addEventListener("click",()=>{this.onSubmit([r.value?new Date(r.value).toISOString():null,a.value?new Date(a.value).toISOString():null,this.selectedValues.size==1]),this.close()});let c=t.createEl("button",{text:"Clear Filter",cls:"ptp-filter-button"});c.addEventListener("click",()=>{this.onSubmit([]),this.close()});let u=t.createEl("div");u.appendChild(r.parentElement),u.appendChild(a.parentElement),this.createCheckbox("",u),t.appendChild(o),t.appendChild(c)}createDefaultFilter(t){this.allowedValues.sort().forEach(i=>{let s=t.createEl("div",{cls:"ptp-filter-value-container"});this.createCheckbox(i,s)});let e=t.createEl("button",{text:"Filtrer",cls:"ptp-filter-button"});e.addEventListener("click",()=>{console.log("ici3"),this.onSubmit(Array.from(this.selectedValues)),this.close()});let n=t.createEl("button",{text:"Clear Filter",cls:"ptp-filter-button"});n.addEventListener("click",()=>{console.log("ici2"),this.onSubmit([]),this.close()}),t.appendChild(e),t.appendChild(n)}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:`${this.col.getPropertyName()}`}),this.col instanceof w?this.createDateRangeFilter(t):this.createDefaultFilter(t)}onClose(){let{contentEl:t}=this;t.empty()}};var $=require("obsidian"),P=class extends $.Modal{constructor(t,e,n){super(t),this.options=e,this.onSubmit=n}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"Entrez un nouveau nom de fichier"});let e=t.createEl("input",{type:"text"});e.style.width="100%",e.focus();let n=t.createEl("div",{text:""});n.style.color="red",n.style.marginTop="10px";let i=p=>p!==""&&!/[\/\\\+\:\*]/.test(p);t.createEl("h3",{text:"Choose Properties to create with"});let s=t.createEl("div",{attr:{style:"margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;"}});s.style.marginTop="10px";let l=[];this.options.forEach(p=>{let m=s.createEl("div"),g=m.createEl("input",{type:"checkbox"});g.checked=!0,l.push(g),m.createEl("label",{text:p.getPropertyName(),attr:{style:"margin-left: 5px;"}})});let r=t.createEl("div");r.style.marginTop="10px",r.createEl("button",{text:"Select All"}).addEventListener("click",()=>{l.forEach(p=>p.checked=!0)});let o=r.createEl("button",{text:"Select None"});o.style.marginLeft="10px",o.addEventListener("click",()=>{l.forEach(p=>p.checked=!1)});let c=()=>{let p=e.value.trim();if(!i(p)){n.setText("Nom invalide : ne doit pas \xEAtre vide et ne pas contenir '/' ou '\\'.");return}let m=this.options.filter((g,S)=>l[S].checked);this.close(),this.onSubmit(p,m)};e.addEventListener("keydown",p=>{p.key==="Enter"&&c()});let u=t.createEl("button",{text:"Cr\xE9er"});u.style.marginTop="10px",u.addEventListener("click",c)}onClose(){let{contentEl:t}=this;t.empty()}};var f=require("obsidian"),H=class extends f.Modal{constructor(e,n,i){super(e);this.dragSrcIndex=null;this.columns=n,this.items=n.map(s=>({column:s,visible:s.getV()})),this.onSubmit=i}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Filtrer et r\xE9organiser les colonnes"});let n=e.createDiv({cls:"column-sort-container"}),i=n.createEl("span",{cls:"sort-alpha"});(0,f.setIcon)(i,"arrow-down-narrow-wide"),i.addEventListener("click",()=>{this.sortItemsAlphabetically(),this.renderList(a)});let s=n.createEl("span",{cls:"sort-alpha-reverse"});(0,f.setIcon)(s,"arrow-up-narrow-wide"),s.addEventListener("click",()=>{this.sortItemsAlphabeticallyReverse(),this.renderList(a)});let l=n.createEl("span",{cls:"show-all"});(0,f.setIcon)(l,"eye"),l.addEventListener("click",()=>{this.items.forEach(c=>c.visible=!0),this.renderList(a)});let r=n.createEl("span",{cls:"hide-all"});(0,f.setIcon)(r,"eye-off"),r.addEventListener("click",()=>{this.items.forEach(c=>c.visible=!1),this.renderList(a)});let a=e.createDiv({cls:"column-filter-list"});this.renderList(a);let o=e.createDiv({cls:"modal-buttons"});new f.ButtonComponent(o).setButtonText("Cancel").onClick(()=>this.close()),new f.ButtonComponent(o).setButtonText("Apply").onClick(()=>{let c=new Map;this.items.forEach((u,p)=>{c.set(u.column,{newIndex:p,visible:u.visible})}),this.onSubmit(c),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}renderList(e){e.empty(),this.items.forEach((n,i)=>{let s=e.createDiv({cls:"column-item",attr:{draggable:"true","data-index":i.toString()}});s.addEventListener("dragstart",r=>{var a;this.dragSrcIndex=i,(a=r.dataTransfer)==null||a.setData("text/plain",i.toString()),s.addClass("dragging")}),s.addEventListener("dragover",r=>(r.preventDefault(),!1)),s.addEventListener("drop",r=>{if(r.preventDefault(),this.dragSrcIndex===null)return;let a=i;this.moveItem(this.dragSrcIndex,a),this.dragSrcIndex=null,this.renderList(e)}),s.addEventListener("dragend",()=>{s.removeClass("dragging"),this.dragSrcIndex=null});let l=s.createEl("span",{cls:"toggle-visibility"});(0,f.setIcon)(l,n.visible?"eye":"eye-off"),l.addEventListener("click",()=>{n.visible=!n.visible,(0,f.setIcon)(l,n.visible?"eye":"eye-off")}),s.createEl("span",{cls:"column-name",text:n.column.getPropertyName()})})}moveItem(e,n){if(e<0||n<0||e>=this.items.length||n>=this.items.length)return;let[i]=this.items.splice(e,1),s=e<n?n-1:n;this.items.splice(s,0,i)}sortItemsAlphabetically(){this.items.sort((e,n)=>e.column.getPropertyName().localeCompare(n.column.getPropertyName()))}sortItemsAlphabeticallyReverse(){this.items.sort((e,n)=>n.column.getPropertyName().localeCompare(e.column.getPropertyName()))}};var W=require("obsidian");var v=class extends h{constructor(t,e){super(t,e)}getUniqDisplayValuesBasedOnSelector(t,e){let n=[];return this.extractCells(t).forEach(s=>{var r,a;let l=s.querySelector(e);l?(l instanceof HTMLInputElement||l instanceof HTMLSelectElement)&&l.value.trim()!==""?n.push(l.value.trim()):((r=l.textContent)==null?void 0:r.trim())!==""?n.push(((a=l.textContent)==null?void 0:a.trim())||""):n.push(""):n.push("")}),[...new Set(n)]}renderMarkdownToDiv(t,e,n){t.empty(),W.MarkdownRenderer.renderMarkdown(e,t,n.path,null),t.querySelectorAll("a").forEach(s=>{s.addEventListener("click",l=>{l.preventDefault();let r=s.getAttribute("href");r&&this.app.workspace.openLinkText(r,"",!0)})})}onSuggestionClick(t,e,n,i){let s=t.value.slice(0,n),l=t.value.slice(n);t.value=s+e+l,t.selectionStart=t.selectionEnd=s.length+e.length,t.focus(),i.suggestMenu&&(i.suggestMenu.style.display="none")}onInput(t,e){var l;if(!t||!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement))return;let n=t.selectionStart||0,s=t.value.slice(0,n).match(/\[\[([^\[\]]*)$/);if(s){let r=s[1].toLowerCase();e.suggestMenu||(e.suggestMenu=createDiv({cls:"link-suggest-menu"}),document.body.appendChild(e.suggestMenu),Object.assign(e.suggestMenu.style,{position:"absolute",zIndex:"1000",overflowY:"auto"}));let a=t.getBoundingClientRect();e.suggestMenu.style.top=`${a.bottom+window.scrollY}px`,e.suggestMenu.style.left=`${a.left+window.scrollX}px`,e.suggestMenu.style.width=`${a.width}px`;let o=this.app.vault.getMarkdownFiles();e.matches=o.filter(c=>c.path.toLowerCase().includes(r)),e.currentIndex=-1,e.suggestMenu.empty(),e.matches.forEach((c,u)=>{let p=createDiv({text:c.path,cls:"suggestion-item"});p.style.padding="4px",p.style.cursor="pointer",p.addEventListener("mousedown",m=>{m.preventDefault();let g=t.selectionStart||0;this.onSuggestionClick(t,c.path,g,e)}),e.suggestMenu.appendChild(p)}),e.suggestMenu.style.display=e.matches.length>0?"block":"none"}else(l=e.suggestMenu)==null||l.remove(),e.suggestMenu=null}onKeydown(t,e,n){if(!(!n.suggestMenu||n.suggestMenu.style.display==="none")){if(t.key==="Escape"){t.preventDefault(),n.suggestMenu.style.display="none",n.currentIndex=-1,this.updateHighlight(n);return}if(t.key==="ArrowDown")t.preventDefault(),n.currentIndex=(n.currentIndex+1)%n.matches.length,this.updateHighlight(n);else if(t.key==="ArrowUp")t.preventDefault(),n.currentIndex=(n.currentIndex-1+n.matches.length)%n.matches.length,this.updateHighlight(n);else if(t.key==="Enter"){if(t.preventDefault(),e instanceof HTMLTextAreaElement){let i=e.selectionStart||0,l=e.value.slice(0,i).match(/\[\[([^\[\]]*)$/);l?this.insertSuggestion(e,n.matches[n.currentIndex],l.index,i,n):e.setRangeText(`
`,i,i,"end")}else if(n.currentIndex>=0&&n.matches[n.currentIndex]){let i=e.selectionStart||0,s=e.value.slice(0,i).match(/\[\[([^\[\]]*)$/);s&&this.insertSuggestion(e,n.matches[n.currentIndex],s.index,i,n)}}}}updateHighlight(t){t.suggestMenu&&Array.from(t.suggestMenu.children).forEach((e,n)=>{e.toggleClass("selected",n===t.currentIndex)})}insertSuggestion(t,e,n,i,s){var a;let l=t.value.slice(0,n),r=t.value.slice(i);t.value=l+`[[${e.path}]]`+r,(a=s.suggestMenu)==null||a.remove(),s.suggestMenu=null,t.focus(),s.currentIndex=-1}filterRows(t){t.forEach(e=>{e.style.display="";let i=e.querySelectorAll("td")[this.getIndex()],s=this.getFilter();if(s.length>0){let l=i?i.textContent.trim():"";s.some(a=>a==""?l=="":l.toLowerCase().includes(a.toString().toLowerCase().replace("[[","").replace("]]","")))||(e.style.display="none")}})}};var A=class extends v{getUniqDisplayValuesFiltered(t){return super.getUniqDisplayValuesBasedOnSelector(t,"a").filter(n=>n!="")}constructor(t,e,n){super(t,e),this.showBOTF=n}getStrType(){return"FILE"}async fillCell(t,e,n,i){this.createHref(t,e);let s=500;if(this.showBOTF)try{let l=await this.app.vault.read(e);if(l.startsWith("---")){let a=l.indexOf("---",3);a!==-1&&(l=l.slice(a+3).trimStart())}let r=l.split(/\r?\n\r?\n/).map(a=>a.trim()).filter(a=>a.length>0);if(r.length>0){let a=r[0];if(a.length>s){let o=a.slice(0,s);a=o.slice(0,o.lastIndexOf(" "))+"\u2026"}t.createEl("div",{cls:"ptp-text-preview",text:a})}}catch(l){console.error("Error reading file preview:",l)}}};var F=class extends v{getUniqDisplayValuesFiltered(t){return super.getUniqDisplayValuesBasedOnSelector(t,"div").filter(n=>n!="")}constructor(t,e){super(t,e)}static getStrType(){return"DIR"}fillCell(t,e,n,i){let s="/"+e.path.substring(0,e.path.lastIndexOf("/"));t.createEl("div",{text:s})}};var G=require("obsidian");var E=class extends v{constructor(t,e){super(t,e)}getStrType(){return"Text"}getUniqDisplayValuesFiltered(t){return super.getUniqDisplayValuesBasedOnSelector(t,"input")}sortRows(t,e){return super.sortRows(t,e)}decodeEmojisInText(t){return t.replace(/emoji\/\/([0-9a-fA-F-]+)/g,(e,n)=>n.split("-").map(s=>String.fromCodePoint(parseInt(s,16))).join(""))}fillCell(t,e,n,i){t.empty(),t.style.position="relative";let s=i!=null?String(i):"";i==null?t.classList.add("ptp-global-table-td-empty"):t.classList.remove("ptp-global-table-td-empty"),s=this.decodeEmojisInText(s);let l=t.createEl("div",{cls:"ptp-text-preview"});(()=>{l.empty(),G.MarkdownRenderer.renderMarkdown(s,l,e.path,null),l.querySelectorAll("a").forEach(p=>{p.addEventListener("click",m=>{m.preventDefault();let g=p.getAttribute("href");g&&this.app.workspace.openLinkText(g,"",!0)})})})();let a=t.createEl("input",{type:"text",cls:"ptp-text-preview"});a.value=s,a.style.display="none",t.appendChild(a);let o=createDiv({cls:"ptp-suggestion-box"});o.style.display="none",t.appendChild(o);let c={currentIndex:-1,matches:[],suggestMenu:null,suggestionBox:o};a.addEventListener("input",()=>this.onInput(a,c)),a.addEventListener("keydown",u=>this.onKeydown(u,a,c)),t.addEventListener("dblclick",()=>{l.style.display="none",a.style.display="block",a.focus()}),a.addEventListener("focus",()=>{a.dataset.oldValue=a.value}),a.addEventListener("blur",async()=>{i=a.value;let u=a.dataset.oldValue;l.style.display="block",a.style.display="none",o.style.display="none",this.renderMarkdownToDiv(l,String(i),e),this.fillCell(t,e,n,i),u!==i&&await this.updateYamlProperty(e.path,n,i==null?"":i.toString(),"update")})}};var C=class extends h{constructor(t,e){super(t,e)}getStrType(){return"Bool"}sortRows(t,e){return this.isSortedAsc=e,t.sort((n,i)=>{let s=n.getElementsByTagName("td")[this.columnIndex],l=i.getElementsByTagName("td")[this.columnIndex],r=s==null?void 0:s.querySelector("input[type='checkbox']"),a=l==null?void 0:l.querySelector("input[type='checkbox']");if(r&&a){let o=r.checked,c=a.checked;return o===c?0:e?o?-1:1:o?1:-1}return 0})}filterRows(t){t.forEach(e=>{e.style.display="";let i=e.querySelectorAll("td")[this.getIndex()];if(this.getFilter().length>0){let s=i==null?void 0:i.querySelector("input");this.getFilter().map(l=>l.toString()).includes(s?s.checked.toString():"")||(e.style.display="none")}})}getUniqDisplayValuesFiltered(t){return[!0,!1,""]}fillCell(t,e,n,i){t.empty();let s=l=>{t.empty();let r=t.createEl("input",{type:"checkbox"});t.classList.remove("ptp-global-table-td-empty"),l==="N"?r.checked=!1:r.checked=l==="T",r.setAttribute("filepath",e.path),r.setAttribute("prop",n),r.addEventListener("change",async()=>{let a=r.checked;r.style.backgroundColor="";let o=r.getAttribute("filepath"),c=r.getAttribute("prop");await this.updateYamlProperty(o,c,a,"update")})};i===void 0?(t.addEventListener("click",()=>s("F"),{once:!0}),t.classList.add("ptp-global-table-td-empty")):i==null?s("N"):s(i?"T":"F")}};var x=class x extends h{constructor(t,e){super(t,e),x.counter=0}filterRows(t){}getUniqDisplayValuesFiltered(t){return[]}static getStrType(){return"ID"}sortRows(t,e){return this.isSortedAsc=e,t.sort((n,i)=>{var o,c,u,p;let s=((c=(o=n.getElementsByTagName("td")[this.columnIndex])==null?void 0:o.textContent)==null?void 0:c.trim().toLowerCase())||"",l=((p=(u=i.getElementsByTagName("td")[this.columnIndex])==null?void 0:u.textContent)==null?void 0:p.trim().toLowerCase())||"",r=parseInt(s),a=parseInt(l);return e?r-a:a-r}),t}fillCell(t,e,n,i){t.empty(),x.counter+=1;let s=t.createEl("div",{text:x.counter.toString()})}};x.counter=0;var L=x;var M=class extends v{constructor(t,e){super(t,e)}getUniqDisplayValuesFiltered(t){let e=[];return this.extractCells(t).forEach(i=>{let s=i.querySelector("textarea");if(s&&s.value!=""){let l=s.value.trim().split(`
`).filter(r=>r!=="");e.push(...l)}}),e.push(""),[...new Set(e)]}filterRows(t){t.forEach(e=>{let i=e.querySelectorAll("td")[this.getIndex()];e.style.display="";let s=[],l=i.querySelectorAll("li");if(s=Array.from(l).map(r=>{var a;return((a=r.textContent)==null?void 0:a.trim())||""}),this.getFilter().length>0){let r=!1;for(let a of this.getFilter())if(a===""){if(s.length===0||s.length===1&&s[0]===""){r=!0;break}}else if(s.some(o=>o.toLowerCase().includes(a.toLowerCase()))){r=!0;break}r||(e.style.display="none")}})}getStrType(){return"List"}sortRows(t,e){return super.sortRows(t,e)}fillCell(t,e,n,i){t.empty(),t.setAttribute("filepath",e.path),t.setAttribute("prop",n);let s=t.createEl("div",{cls:"ptp-markdown-preview"}),l=Array.isArray(i)?i:[i],r=s.createEl("ul",{cls:"ptp-list-ul"});l.length===1&&l[0]==null?t.classList.add("ptp-global-table-td-empty"):(t.classList.remove("ptp-global-table-td-empty"),l.forEach(u=>{if(u==null)return;let p=r.createEl("li",{cls:"ptp-list-il"});if(/^\[\[.*\]\]$/.test(u)){let m=u.replace(/^\[\[|\]\]$/g,""),g=this.app.metadataCache.getFirstLinkpathDest(m,"");g==null?this.createHref(p,m):this.createHref(p,g)}else p.createEl("span",{text:u})}));let a=t.createEl("textarea",{cls:"ptp-textarea",text:l.join(`
`)});a.style.display="none",t.addEventListener("dblclick",()=>{s.style.display="none",a.style.display="block",a.focus()}),a.addEventListener("focus",()=>{a.dataset.oldValue=a.value}),a.addEventListener("blur",async()=>{let u=a.dataset.oldValue;s.style.display="block",a.style.display="none";let p=a.value.trim().split(`
`).filter(m=>m!=="");p.length===0?t.classList.add("ptp-global-table-td-empty"):t.classList.remove("ptp-global-table-td-empty"),this.fillCell(t,e,n,p),u!==a.value&&await this.updateYamlProperty(e.path,n,p,"update")});let o=createDiv({cls:"ptp-suggest-menu"});document.body.appendChild(o);let c={suggestMenu:o,currentIndex:-1,matches:[],input:a,filepath:e.path};a.addEventListener("input",u=>this.onInput(a,c)),a.addEventListener("keydown",u=>this.onKeydown(u,a,c))}};var I=class extends h{constructor(t,e){super(t,e)}filterRows(t){t.forEach(e=>{let i=e.querySelectorAll("td")[this.getIndex()];if(e.style.display="",this.getFilter().length>0){let s=i==null?void 0:i.querySelector("input");if(this.getFilter().includes("")&&(s==null?void 0:s.value)=="")e.style.display="";else if((s==null?void 0:s.value)=="")e.style.display="none";else{let l=Number(s==null?void 0:s.value);this.getFilter().filter((o,c)=>o!=="").map(o=>Number(o)).includes(l)||(e.style.display="none")}}})}getUniqDisplayValuesFiltered(t){let e=[];return this.extractCells(t).forEach(i=>{let s=i.querySelector("input");if(s&&s.value!=""){let l=Number(s.value);if(isNaN(l))return;(this.getFilter().length==0||this.getFilter().map(r=>Number(r)).includes(l))&&e.push(l)}else e.push("")}),[...new Set(e)]}getStrType(){return"Int"}sortRows(t,e){return this.isSortedAsc=e,t.sort((n,i)=>{let s=n.getElementsByTagName("td")[this.columnIndex],l=i.getElementsByTagName("td")[this.columnIndex],r=s==null?void 0:s.querySelector("input"),a=l==null?void 0:l.querySelector("input"),o=r&&!isNaN(parseInt(r.value)),c=a&&!isNaN(parseInt(a.value));if(o&&c){let u=parseInt(r.value),p=parseInt(a.value);return e?u-p:p-u}else return o?e?-1:1:c?e?1:-1:0}),t}fillCell(t,e,n,i){t.empty();let s=t.createEl("input",{type:"number"});i==null||i==null||i.toString()==""?(s.style.display="none",t.classList.add("ptp-global-table-td-empty")):s.value=Number(i).toString(),s.setAttribute("filepath",e.path),s.setAttribute("prop",n),s.step="1",s.addEventListener("change",async()=>{let l=s.value.trim(),r=s.getAttribute("filepath"),a=s.getAttribute("prop");l===""?(await this.updateYamlProperty(r,a,"","delete"),t.classList.add("ptp-global-table-td-empty")):(await this.updateYamlProperty(r,a,Number(l),"update"),t.classList.remove("ptp-global-table-td-empty"),s.style.display="none")}),t.addEventListener("click",()=>{t.classList.remove("ptp-global-table-td-empty"),s.style.display="block",s.focus()}),s.addEventListener("focus",()=>{s.dataset.oldValue=s.value}),s.addEventListener("blur",async()=>{let l=s.value,r=s.dataset.oldValue;s.style.display="none",this.fillCell(t,e,n,l),l!==r&&await this.updateYamlProperty(e.path,n,l===""?null:Number(l),"update")})}};var U={"plugin.name":"Folder Property Manager","column.dir":"directories","column.file":"files","column.id":"id"};var j={"plugin.name":"Folder Property Manager","column.dir":"r\xE9pertoires","column.file":"fichiers","column.id":"id"};var _={en:U,fr:j},D=class{constructor(t){var e;this.lang=((e=t.appLocale)==null?void 0:e.lang)||"en",this.translations=_[this.lang]||_.en}t(t){return this.translations[t]||t}};var N=class N extends b.ItemView{constructor(e,n){super(e);this.fileProperties=[];this.propColStart=3;this.scale=1;this.columnsMapping=[];this.folderPath="/";this.tablecreated=!1;this.settings=n,this.sortedColumn=null,this.i18n=new D(this.app)}rebuildTheView(){this.tablecreated=!1,this.createTablePropView()}refreshView(){this.createTablePropView()}getViewType(){return N.GLOBAL_PROPERTIES_VIEW}getIcon(){return"wrench"}getDisplayText(){return this.folderPath}getFolderPath(){return this.folderPath}async setState(e,n){console.log("setState"),e.folderPath&&(this.folderPath=e.folderPath),await super.setState(e,n)}getState(){return console.log("getState"),{folderPath:this.folderPath}}filterColumns(){new H(this.app,this.columnsMapping.slice(3),n=>{let i=this.columnsMapping.slice(0,3),s=this.columnsMapping.slice(3),l=new Array(s.length);n.forEach((a,o)=>{s.findIndex(u=>u===o)!==-1&&(o.setV(a.visible),l[a.newIndex]=o)}),this.columnsMapping=[...i,...l];let r=0;L.counter=0,this.columnsMapping.forEach(a=>{a.setIndex(r),r+=1}),this.createHTMLTablePropView()}).open()}buildButtonHeader(){let e=this.contentEl.createEl("div",{cls:"ptp-button-list-g"}),n=e.createEl("a",{cls:"ptp-global-button",attr:{href:"#"}}),i=document.createElement("div");(0,b.setIcon)(i,"refresh-cw"),n.appendChild(i),n.addEventListener("click",async u=>{u.preventDefault(),await this.rebuildTheView()});let s=e.createEl("a",{cls:"ptp-global-button",attr:{href:"#"}}),l=document.createElement("div");(0,b.setIcon)(l,"filter-x"),s.appendChild(l),s.addEventListener("click",async u=>{u.preventDefault(),this.clearAllFilters()});let r=e.createEl("a",{cls:"ptp-global-button",attr:{href:"#"}}),a=document.createElement("div");(0,b.setIcon)(a,"file-plus-2"),r.appendChild(a),r.addEventListener("click",async u=>{u.preventDefault(),await this.addANewFile()});let o=e.createEl("a",{cls:"ptp-global-button",attr:{href:"#"}}),c=document.createElement("div");(0,b.setIcon)(c,"eye"),o.appendChild(c),o.addEventListener("click",async u=>{this.filterColumns()})}applyVisibility(){this.table.querySelectorAll(".ptp-th-container").forEach(n=>{let i=Number(n.getAttribute("columnIdx"));this.columnsMapping[i].getV()?n.style.display="":n.style.display="none"}),this.columnsMapping.forEach(n=>{n.applyV(this.getRows())})}createHTMLTablePropView(){var i;let{contentEl:e}=this;e.empty(),e.classList.add("ptp-global-container");let n=e.createEl("h1",{text:"Properties of "+this.folderPath,cls:"ptp-h1-title"});this.buildButtonHeader(),(i=this.table)==null||i.empty(),this.table=e.createEl("table",{cls:"ptp-global-table"}),this.buildTableHeader(),this.buildTableBody(),this.applyVisibility(),this.addZoomFeature(),this.sortedColumn!=null&&this.sortTable(this.sortedColumn,this.sortedColumn.getSortedAsc()),e.scrollTop=0}createColumnsMappingArray(){let e=[],n={};this.columnsMapping&&(e=this.columnsMapping.map(i=>i.getPropertyName()),n=Object.fromEntries(this.columnsMapping.map(i=>[i.getPropertyName(),i.getV()]))),this.columnsMapping=this.buildFileProperties(),this.columnsMapping.unshift(new A(this.i18n.t("column.file"),this.app,this.settings.showFilePreviewInTextColumn)),this.columnsMapping.unshift(new F(this.i18n.t("column.dir"),this.app)),this.columnsMapping.unshift(new L("\u21C5",this.app)),e.length>0&&(this.columnsMapping.sort((i,s)=>{let l=e.indexOf(i.getPropertyName()),r=e.indexOf(s.getPropertyName());return l===-1&&r===-1?0:l===-1?1:r===-1?-1:l-r}),this.columnsMapping.forEach(i=>{let s=i.getPropertyName();n.hasOwnProperty(s)&&i.setV(n[s])}))}createTablePropView(){this.tablecreated!=!0&&(this.tablecreated=!0,L.counter=0,this.createColumnsMappingArray(),this.createHTMLTablePropView())}async onOpen(){console.log("onOpen")}detectPropertyType(e,n,i){let s=o=>/^\d{4}-\d{2}-\d{2}$/.test(o),l=o=>/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}(:\d{2})?$/.test(o),r=i.get(e),a=o=>!isNaN(o);return(n==null||n==="")&&r==null?null:r instanceof M||Array.isArray(n)?new M(e,this.app):typeof n=="string"?r instanceof E||r instanceof C||r instanceof I?new E(e,this.app):l(n)?new w(e,this.app,"datetime-local"):s(n)?r!=null&&r.getDType()=="datetime-local"?r:new w(e,this.app,"date"):new E(e,this.app):typeof n=="number"||typeof n!="boolean"&&a(n)?r==null?new I(e,this.app):r:typeof n=="boolean"?r instanceof I||r instanceof w?new E(e,this.app):r==null?new C(e,this.app):r:new E(e,this.app)}buildFileProperties(){let e=this.app.vault.getMarkdownFiles().filter(s=>{var l,r;return this.folderPath==="/"?!0:((l=s.parent)==null?void 0:l.path)===this.folderPath||((r=s.parent)==null?void 0:r.path.startsWith(this.folderPath+"/"))}),n=new Map;this.fileProperties=[];for(let s of e){let l=this.app.metadataCache.getFileCache(s);if(l&&l.frontmatter){let r={};for(let a in l.frontmatter){let o=l.frontmatter[a],c=this.detectPropertyType(a,o,n);n.set(a,c),c!=null&&c.addCnt1(),r[a]=o}this.fileProperties.push({file:s,props:r})}else this.fileProperties.push({file:s,props:{}})}return n.forEach((s,l)=>{s===null&&n.set(l,new E(l,this.app))}),Array.from(new Set(Array.from(n.values()))).filter(s=>s!==null).sort((s,l)=>l.getCnt()-s.getCnt())}buildTableHeader(){if(!this.table)return;let n=this.table.createEl("thead",{cls:"ptp-th-container"}).createEl("tr");for(let i=0;i<this.columnsMapping.length;i++)this.columnsMapping[i].setIndex(i),this.columnsMapping[i].setId("c"+i);this.columnsMapping.forEach(i=>{let s=n.createEl("th",{cls:"ptp-th-container",attr:{columnIdx:i.getIndex()}}),l=s.createEl("div",{cls:"ptp-th-content"}),r=l.createEl("span",{text:i.getPropertyName(),cls:"ptp-th-text"}),a=l.createEl("button",{cls:"ptp-th-action"});a.textContent="\u22EE",a.addEventListener("click",o=>{o.stopPropagation(),this.showContextMenu(o,i)}),s.appendChild(l)})}showContextMenu(e,n){var a;(a=document.querySelector(".ptp-context-menu"))==null||a.remove();let i=document.createElement("div");i.classList.add("ptp-context-menu");let s=document.createElement("div");s.textContent="col type : "+n.getStrType(),i.appendChild(s);let l=(o,c)=>{let u=document.createElement("div");if(u.classList.add("ptp-menu-option-button"),o){let p=document.createElement("div");(0,b.setIcon)(p,o),u.appendChild(p)}return u.addEventListener("click",()=>{c(),i.remove()}),u},r=document.createElement("div");s.classList.add("ptp-menu-option-button-div"),r.appendChild(l("arrow-down-narrow-wide",()=>this.sortTable(n,!0))),r.appendChild(l("arrow-up-narrow-wide",()=>this.sortTable(n,!1))),n instanceof L||(r.appendChild(l("filter",()=>this.openFilterModal(n))),r.appendChild(l("filter-x",()=>{n.setFilter([]),this.reapplyAllFilters()}))),i.appendChild(r),document.body.appendChild(i),i.style.top=`${e.clientY}px`,i.style.left=`${e.clientX}px`,setTimeout(()=>{document.addEventListener("click",()=>i.remove(),{once:!0})},10)}updateFilterButtonStyles(){document.querySelectorAll(".ptp-th-container").forEach(n=>{this.columnsMapping[Number(n.getAttribute("columnIdx"))].getFilter().length>0?n.classList.add("ptp-filter-button-active"):n.classList.remove("ptp-filter-button-active")})}openFilterModal(e){let n=e.getUniqDisplayValuesFiltered(this.getRows());new V(this.app,e,n,s=>{e.setFilter(s),this.reapplyAllFilters(),this.updateFilterButtonStyles()}).open()}reapplyAllFilters(){let e=this.getRows();e.forEach(n=>n.style.display=""),this.columnsMapping.forEach(n=>{n.filterRows(e),e=this.getRows().filter(i=>i.style.display==""),this.updateFilterButtonStyles()})}clearAllFilters(){this.columnsMapping.forEach(e=>{e.setFilter([]),e.filterRows(this.getRows()),this.updateFilterButtonStyles()})}getRows(){let e=this.table.querySelector("tbody");return Array.from(e.querySelectorAll("tr"))}buildTableBody(){if(!this.table)return;let e=this.table.createEl("tbody",{cls:"ptp-tbody-container"});for(let{file:n,props:i}of this.fileProperties){let s=e.createEl("tr");this.columnsMapping.forEach(l=>{let r=l.getPropertyName(),a=i[r],o=s.createEl("td",{cls:"ptp-td-container"});l.fillCell(o,n,r,a)})}}sortTable(e,n){if(!this.table)return;let i=this.table.querySelector("tbody");if(!i)return;let s=Array.from(i.getElementsByTagName("tr"));i.append(...e.sortRows(s,n)),this.sortedColumn=e}addZoomFeature(){let e=this.table.parentElement;e&&(e.style.overflow="auto",e.style.overflowX="auto",e.style.whiteSpace="nowrap",e.style.maxWidth="100%",this.table.style.transform=`scale(${this.scale})`,this.table.style.transformOrigin="top left",this.table.addEventListener("wheel",n=>{if(n.shiftKey)n.preventDefault(),e.scrollLeft+=n.deltaY;else if(n.ctrlKey){n.preventDefault();let i=.1;n.deltaY<0?this.scale+=i:this.scale=Math.max(.5,this.scale-i),this.table.style.transform=`scale(${this.scale})`,this.table.style.transformOrigin="top left"}}))}addANewFile(){new P(this.app,this.columnsMapping.slice(3),async(e,n)=>{let i=e.endsWith(".md")?e:`${e}.md`,s=`${this.folderPath}/${i}`,l=n;if(this.app.vault.getAbstractFileByPath(s)){new b.Notice("Un fichier avec ce nom existe d\xE9j\xE0 !");return}try{let r="";if(l.length>0){r=`---
`;for(let o of l)r+=o.getPropertyName()+`:
`;r+=`---
`}let a=await this.app.vault.create(s,r);new b.Notice(`Fichier "${s}" cr\xE9\xE9 avec succ\xE8s !`)}catch(r){new b.Notice("Erreur lors de la cr\xE9ation du fichier."),console.error(r)}}).open()}getAllValuesForProperty(e){let n=new Set;for(let{props:i}of this.fileProperties)i[e]!==void 0&&n.add(i[e]);return Array.from(n)}async onClose(){this.contentEl.empty()}};N.GLOBAL_PROPERTIES_VIEW="glbVeID";var y=N;var k=require("obsidian"),K={shouldAddRibbon:!1,showFilePreviewInTextColumn:!0},R=class extends k.PluginSettingTab{constructor(t){super(t.app,t),this.plugin=t}display(){let{containerEl:t}=this;t.empty(),new k.Setting(t).setName("Show ribbon icon").setDesc("Toggle the ribbon icon in the sidebar. (Allow table properties of the entire Vault). Warning can be slow").addToggle(e=>e.setValue(this.plugin.settings.shouldAddRibbon).onChange(async n=>{this.plugin.settings.shouldAddRibbon=n,await this.plugin.updateRibbon(),await this.plugin.saveSettings()})),new k.Setting(t).setName("Show begin file in file column").setDesc("If enabled, the beginning of the file will be displayed in file columns.").addToggle(e=>e.setValue(this.plugin.settings.showFilePreviewInTextColumn).onChange(async n=>{this.plugin.settings.showFilePreviewInTextColumn=n,await this.plugin.saveSettings()}))}};var B=class extends O.Plugin{constructor(){super(...arguments);this.ribbonIconEl=null}async updateRibbon(){this.settings.shouldAddRibbon?this.ribbonIconEl||(this.ribbonIconEl=this.addRibbonIcon("wrench","Global Properties",e=>{this.openTab(this.app.vault.getRoot())})):this.ribbonIconEl&&(this.ribbonIconEl.remove(),this.ribbonIconEl=null)}async onload(){await this.loadSettings(),this.registerView(y.GLOBAL_PROPERTIES_VIEW,e=>new y(e,this.settings)),this.addSettingTab(new R(this)),this.app.workspace.on("active-leaf-change",this.refreshView.bind(this)),this.registerEvent(this.app.workspace.on("file-menu",(e,n)=>{n instanceof O.TFolder&&e.addItem(i=>{i.setTitle("Property that folder").setIcon("wrench").onClick(()=>{this.openTab(n)})})})),this.app.vault.on("create",e=>{this.refreshAllView()}),this.app.vault.on("rename",e=>{this.refreshAllView()}),this.app.vault.on("delete",e=>{this.refreshAllView()})}refreshAllView(){let e=this.app.workspace.getLeavesOfType(y.GLOBAL_PROPERTIES_VIEW);for(let n of e){let i=n.view;i instanceof y&&i.rebuildTheView()}}refreshView(){let e=this.app.workspace.activeLeaf;e&&e.view instanceof y&&e.view.rebuildTheView()}async loadSettings(){this.settings=Object.assign({},K,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async openTab(e){let n=this.app.workspace.getLeavesOfType(y.GLOBAL_PROPERTIES_VIEW);for(let l of n){let r=l.view;if(r instanceof y&&r.getFolderPath()===e.path){this.app.workspace.setActiveLeaf(l);return}}let i=this.app.workspace.getLeaf(!0);await i.setViewState({type:y.GLOBAL_PROPERTIES_VIEW,active:!0,state:{folderPath:e.path}});let s=i.view;s instanceof y?(console.log("Vue correctement r\xE9cup\xE9r\xE9e :",s),s.createTablePropView()):console.error("Vue non reconnue !")}};
